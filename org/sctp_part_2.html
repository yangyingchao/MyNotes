<!DOCTYPE html>
<html  lang="en" dir="ltr" prefix="content: http://purl.org/rss/1.0/modules/content/  dc: http://purl.org/dc/terms/  foaf: http://xmlns.com/foaf/0.1/  og: http://ogp.me/ns#  rdfs: http://www.w3.org/2000/01/rdf-schema#  schema: http://schema.org/  sioc: http://rdfs.org/sioc/ns#  sioct: http://rdfs.org/sioc/types#  skos: http://www.w3.org/2004/02/skos/core#  xsd: http://www.w3.org/2001/XMLSchema# " class="no-js wf-loading">
  <head>
    <meta charset="utf-8" />
<meta name="Generator" content="Drupal 8 (https://www.drupal.org)" />
<meta name="MobileOptimized" content="width" />
<meta name="HandheldFriendly" content="true" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="/themes/linuxjournal/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="canonical" href="https://www.linuxjournal.com/article/9749" />
<link rel="shortlink" href="https://www.linuxjournal.com/node/9749" />
<link rel="revision" href="https://www.linuxjournal.com/article/9749" />

    <title>Stream Control Transmission Protocol (SCTP) Associations | Linux Journal</title>
    <link rel="stylesheet" media="all" href="/core/modules/system/css/components/align.module.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/core/modules/system/css/components/fieldgroup.module.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/core/modules/system/css/components/container-inline.module.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/core/modules/system/css/components/clearfix.module.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/core/modules/system/css/components/details.module.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/core/modules/system/css/components/hidden.module.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/core/modules/system/css/components/item-list.module.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/core/modules/system/css/components/js.module.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/core/modules/system/css/components/nowrap.module.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/core/modules/system/css/components/position-container.module.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/core/modules/system/css/components/progress.module.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/core/modules/system/css/components/reset-appearance.module.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/core/modules/system/css/components/resize.module.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/core/modules/system/css/components/sticky-header.module.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/core/modules/system/css/components/system-status-counter.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/core/modules/system/css/components/system-status-report-counters.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/core/modules/system/css/components/system-status-report-general-info.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/core/modules/system/css/components/tablesort.module.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/core/modules/system/css/components/tree-child.module.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/modules/contrib/poll/css/poll.base.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/modules/contrib/poll/css/poll.theme.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/core/modules/views/css/views.module.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/modules/contrib/webform/modules/webform_bootstrap/css/webform_bootstrap.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/libraries/shariff/shariff.complete.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/themes/linuxjournal/css/style.css?r3i2mx" />
<link rel="stylesheet" media="all" href="/themes/linuxjournal/css/fonts.css?r3i2mx" />

      <!--   <script defer src="https://use.fontawesome.com/releases/v5.0.9/js/all.js" integrity="sha384-8iPTk2s/jMVj81dnzb/iFR2sdA7u06vHJyyLlAd4snFpCl/SnyUjRrbdJsw1pGIl" crossorigin="anonymous"></script>-->

    <script>
      // Non-blocking webfonts.
      (function iife() {
        'use strict';

        // JS is able to start executing.
        document.documentElement.classList.remove('no-js');

        // Optimization for Repeat Views
        // Stop early for repeat views that have already cached fonts.
        if (sessionStorage.fontsLoadedLateef && sessionStorage.fontsLoadedOpensans /* && sessionStorage.fontsLoadedNEWFONT */) {
          document.documentElement.classList.remove('wf-loading');
          document.documentElement.classList.add('wf-opensans');
          document.documentElement.classList.add('wf-lateef');
          // document.documentElement.classList.add('wf-NEWFONT');
          return;
        }

        // Inlined Font Face Observer script + Promise polyfill.
        /*! Font Face Observer v2.0.13 - © Bram Stein. License: BSD-3-Clause */
        (function(){'use strict';var f,g=[];function l(a){g.push(a);1==g.length&&f()}function m(){for(;g.length;)g[0](),g.shift()}f=function(){setTimeout(m)};function n(a){this.a=p;this.b=void 0;this.f=[];var b=this;try{a(function(a){q(b,a)},function(a){r(b,a)})}catch(c){r(b,c)}}var p=2;function t(a){return new n(function(b,c){c(a)})}function u(a){return new n(function(b){b(a)})}function q(a,b){if(a.a==p){if(b==a)throw new TypeError;var c=!1;try{var d=b&&b.then;if(null!=b&&"object"==typeof b&&"function"==typeof d){d.call(b,function(b){c||q(a,b);c=!0},function(b){c||r(a,b);c=!0});return}}catch(e){c||r(a,e);return}a.a=0;a.b=b;v(a)}}
        function r(a,b){if(a.a==p){if(b==a)throw new TypeError;a.a=1;a.b=b;v(a)}}function v(a){l(function(){if(a.a!=p)for(;a.f.length;){var b=a.f.shift(),c=b[0],d=b[1],e=b[2],b=b[3];try{0==a.a?"function"==typeof c?e(c.call(void 0,a.b)):e(a.b):1==a.a&&("function"==typeof d?e(d.call(void 0,a.b)):b(a.b))}catch(h){b(h)}}})}n.prototype.g=function(a){return this.c(void 0,a)};n.prototype.c=function(a,b){var c=this;return new n(function(d,e){c.f.push([a,b,d,e]);v(c)})};
        function w(a){return new n(function(b,c){function d(c){return function(d){h[c]=d;e+=1;e==a.length&&b(h)}}var e=0,h=[];0==a.length&&b(h);for(var k=0;k<a.length;k+=1)u(a[k]).c(d(k),c)})}function x(a){return new n(function(b,c){for(var d=0;d<a.length;d+=1)u(a[d]).c(b,c)})};window.Promise||(window.Promise=n,window.Promise.resolve=u,window.Promise.reject=t,window.Promise.race=x,window.Promise.all=w,window.Promise.prototype.then=n.prototype.c,window.Promise.prototype["catch"]=n.prototype.g);}());

        (function(){function l(a,b){document.addEventListener?a.addEventListener("scroll",b,!1):a.attachEvent("scroll",b)}function m(a){document.body?a():document.addEventListener?document.addEventListener("DOMContentLoaded",function c(){document.removeEventListener("DOMContentLoaded",c);a()}):document.attachEvent("onreadystatechange",function k(){if("interactive"==document.readyState||"complete"==document.readyState)document.detachEvent("onreadystatechange",k),a()})};function r(a){this.a=document.createElement("div");this.a.setAttribute("aria-hidden","true");this.a.appendChild(document.createTextNode(a));this.b=document.createElement("span");this.c=document.createElement("span");this.h=document.createElement("span");this.f=document.createElement("span");this.g=-1;this.b.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;";this.c.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;";
        this.f.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;";this.h.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;";this.b.appendChild(this.h);this.c.appendChild(this.f);this.a.appendChild(this.b);this.a.appendChild(this.c)}
        function t(a,b){a.a.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;white-space:nowrap;font-synthesis:none;font:"+b+";"}function y(a){var b=a.a.offsetWidth,c=b+100;a.f.style.width=c+"px";a.c.scrollLeft=c;a.b.scrollLeft=a.b.scrollWidth+100;return a.g!==b?(a.g=b,!0):!1}function z(a,b){function c(){var a=k;y(a)&&a.a.parentNode&&b(a.g)}var k=a;l(a.b,c);l(a.c,c);y(a)};function A(a,b){var c=b||{};this.family=a;this.style=c.style||"normal";this.weight=c.weight||"normal";this.stretch=c.stretch||"normal"}var B=null,C=null,E=null,F=null;function G(){if(null===C)if(J()&&/Apple/.test(window.navigator.vendor)){var a=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))(?:\.([0-9]+))/.exec(window.navigator.userAgent);C=!!a&&603>parseInt(a[1],10)}else C=!1;return C}function J(){null===F&&(F=!!document.fonts);return F}
        function K(){if(null===E){var a=document.createElement("div");try{a.style.font="condensed 100px sans-serif"}catch(b){}E=""!==a.style.font}return E}function L(a,b){return[a.style,a.weight,K()?a.stretch:"","100px",b].join(" ")}
        A.prototype.load=function(a,b){var c=this,k=a||"BESbswy",q=0,D=b||3E3,H=(new Date).getTime();return new Promise(function(a,b){if(J()&&!G()){var M=new Promise(function(a,b){function e(){(new Date).getTime()-H>=D?b():document.fonts.load(L(c,'"'+c.family+'"'),k).then(function(c){1<=c.length?a():setTimeout(e,25)},function(){b()})}e()}),N=new Promise(function(a,c){q=setTimeout(c,D)});Promise.race([N,M]).then(function(){clearTimeout(q);a(c)},function(){b(c)})}else m(function(){function u(){var b;if(b=-1!=
        f&&-1!=g||-1!=f&&-1!=h||-1!=g&&-1!=h)(b=f!=g&&f!=h&&g!=h)||(null===B&&(b=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),B=!!b&&(536>parseInt(b[1],10)||536===parseInt(b[1],10)&&11>=parseInt(b[2],10))),b=B&&(f==v&&g==v&&h==v||f==w&&g==w&&h==w||f==x&&g==x&&h==x)),b=!b;b&&(d.parentNode&&d.parentNode.removeChild(d),clearTimeout(q),a(c))}function I(){if((new Date).getTime()-H>=D)d.parentNode&&d.parentNode.removeChild(d),b(c);else{var a=document.hidden;if(!0===a||void 0===a)f=e.a.offsetWidth,
        g=n.a.offsetWidth,h=p.a.offsetWidth,u();q=setTimeout(I,50)}}var e=new r(k),n=new r(k),p=new r(k),f=-1,g=-1,h=-1,v=-1,w=-1,x=-1,d=document.createElement("div");d.dir="ltr";t(e,L(c,"sans-serif"));t(n,L(c,"serif"));t(p,L(c,"monospace"));d.appendChild(e.a);d.appendChild(n.a);d.appendChild(p.a);document.body.appendChild(d);v=e.a.offsetWidth;w=n.a.offsetWidth;x=p.a.offsetWidth;I();z(e,function(a){f=a;u()});t(e,L(c,'"'+c.family+'",sans-serif'));z(n,function(a){g=a;u()});t(n,L(c,'"'+c.family+'",serif'));
        z(p,function(a){h=a;u()});t(p,L(c,'"'+c.family+'",monospace'))})})};"object"===typeof module?module.exports=A:(window.FontFaceObserver=A,window.FontFaceObserver.prototype.load=A.prototype.load);}());

        // Load and observe Lateef
        var Lateef = new FontFaceObserver('Lateef', {weight: 400});
        Promise.all([Lateef.load()]).then(function() {
          document.documentElement.classList.remove('wf-loading');
          document.documentElement.classList.add('wf-lateef');

          // Optimization for Repeat Views
          // Set a flag in localstorage so repeat views can skip processing FFO.
          sessionStorage.fontsLoadedLateef = true;
        });

        // Load and observe Open Sans
        var os300 = new FontFaceObserver('Open Sans', {weight: 300});
        var os400 = new FontFaceObserver('Open Sans', {weight: 400});
        Promise.all([os300.load(), os400.load()]).then(function() {
          document.documentElement.classList.remove('wf-loading');
          document.documentElement.classList.add('wf-opensans');

          // Optimization for Repeat Views
          // Set a flag in localstorage so repeat views can skip processing FFO.
          sessionStorage.fontsLoadedOpensans = true;
        });

        // Load and observe NEWFONT
        /*
        var NEWFONT = new FontFaceObserver('NEWFONT', {weight: 400});
        Promise.all([NEWFONT.load()]).then(function() {
          document.documentElement.classList.remove('wf-loading');
          document.documentElement.classList.add('wf-NEWFONT');

          // Optimization for Repeat Views
          // Set a flag in localstorage so repeat views can skip processing FFO.
          sessionStorage.fontsLoadedNEWFONT = true;
        });
        */
      })();
    </script>
    
<!--[if lte IE 8]>
<script src="/core/assets/vendor/html5shiv/html5shiv.min.js?v=3.7.3"></script>
<![endif]-->

    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <script src=https://slashdot.org/country.js></script>
    <script src="//a.fsdn.com/con/js/sftheme/cmp2.js"></script>
    <link rel="stylesheet" href="//a.fsdn.com/con/css/sftheme/sandiego/cmp.css" type="text/css">
    <link rel="stylesheet" href="/themes/linuxjournal/css/ccpa.css" type="text/css">
    <script>
    if (window.is_euro_union == 1 || (window.country_code2 == 'US' && window.region == 'CA')) {
     window.bizx.cmp.init({}, 'consentmanager.net');
    }
    </script>
    <script>
    function bm_trace() {
        (function (w,d,t) {
          _ml = w._ml || {};
          _ml.eid = '771';
          var s, cd, tag; s = d.getElementsByTagName(t)[0]; cd = new Date();
          tag = d.createElement(t); tag.async = 1;
          tag.src = 'https://ml314.com/tag.aspx?' + cd.getDate() + cd.getMonth();
          s.parentNode.insertBefore(tag, s);
        })(window,document,'script');
    }
    bizx.cmp.ifConsent('', ['all', 'bombora'],bm_trace);
    </script>

  </head>
  <body class="path-node page-node-type-xmlnode has-glyphicons">
    <a href="#main-content" class="visually-hidden focusable skip-link">
      Skip to main content
    </a>
    
      <div class="dialog-off-canvas-main-canvas" data-off-canvas-main-canvas>
    <div id="wrap">
<div class="leader-wrapper" id="leader-wrapper">
</div>

<div class="brand-wrapper" id="brand-wrapper">
  <div class="brand container">
    <div class="region region-brand">
          <a class="logo navbar-btn" href="/" title="Home" rel="home">
      <h1><img src="/themes/linuxjournal/images/ljlogo.png" alt="Linux Journal" /></h1>
    </a>
      <section id="block-topbannernearlogo" class="block block-block-content block-block-contenta8e75a3d-967c-416d-8944-4015d1f90a84 clearfix">
  
    

      
            <div class="field field--name-body field--type-text-with-summary field--label-hidden field--item"><p></p>
</div>
      
  </section>


  </div>

  </div>

          <div class="header-wrapper">
    <header class="navbar navbar-default container" id="navbar" role="banner">
                                            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
                <div id="navbar-collapse" class="navbar-collapse collapse">
            <div class="region region-navigation-collapsible">
    <section id="block-linuxjournal-main-menu" class="block block-system block-system-menu-blockmain clearfix navbar__menu col-xs-12 col-sm-8">
  
    

      
      <ul class="menu menu--main nav navbar-nav">
                        <li class="expanded dropdown">
        <a href="/" class="dropdown-toggle" data-toggle="dropdown">Topics+ <span class="caret"></span></a>
                          <ul class="dropdown-menu">
                        <li>
        <a href="/tag/cloud">Cloud</a>
                  </li>
                        <li>
        <a href="/tag/containers" data-drupal-link-system-path="taxonomy/term/978">Containers</a>
                  </li>
                        <li>
        <a href="/tag/desktop">Desktop</a>
                  </li>
                        <li>
        <a href="/tag/kernel" data-drupal-link-system-path="taxonomy/term/662">Kernel</a>
                  </li>
                        <li>
        <a href="/tag/mobile">Mobile</a>
                  </li>
                        <li>
        <a href="/tag/networking">Networking</a>
                  </li>
                        <li>
        <a href="/tag/privacy">Privacy</a>
                  </li>
                        <li>
        <a href="/tag/programming">Programming</a>
                  </li>
                        <li>
        <a href="/tag/security" data-drupal-link-system-path="taxonomy/term/31">Security</a>
                  </li>
                        <li>
        <a href="/tag/servers">Servers</a>
                  </li>
                        <li>
        <a href="/tag/sysadmin" data-drupal-link-system-path="taxonomy/term/21">SysAdmin</a>
                  </li>
        </ul>
  
            </li>
                        <li>
        <a href="/news" data-drupal-link-system-path="news">News</a>
                  </li>
                        <li>
        <a href="/books" data-drupal-link-system-path="books">eBooks</a>
                  </li>
        </ul>
  

  </section>

<section class="search-block-form block block-search block-search-form-block clearfix navbar__search col-xs-12 col-sm-4 col-md-4 col-md-offset-0" data-drupal-selector="search-block-form" id="block-linuxjournal-search" role="search">
  
      <h2 class="block-title sr-only">Search</h2>
    

      <form action="/search/node" method="get" id="search-block-form" accept-charset="UTF-8">
  <div class="form-item js-form-item form-type-search js-form-type-search form-item-keys js-form-item-keys form-no-label form-group">
      <label for="edit-keys" class="control-label sr-only">Search</label>
  
  
  <div class="input-group"><input title="Enter the terms you wish to search for." data-drupal-selector="edit-keys" class="form-search form-control" placeholder="Search" type="search" id="edit-keys" name="keys" value="" size="15" maxlength="128" /><span class="input-group-btn"><button type="submit" value="Search" class="button js-form-submit form-submit btn-primary btn icon-only" name=""><span class="sr-only">Search</span><span class="icon glyphicon glyphicon-search" aria-hidden="true"></span></button></span></div>

  
  
      <div id="edit-keys--description" class="description help-block">
      Enter the terms you wish to search for.
    </div>
  </div>
<div class="form-actions form-group js-form-wrapper form-wrapper" data-drupal-selector="edit-actions" id="edit-actions"></div>

</form>

  </section>


  </div>

        </div>
            <div class="navbar-header">
          <div class="region region-navigation">
    <section id="block-mobilenavigation" class="block block-system block-system-menu-blockmenu-mobile-navbar clearfix col-xs-12 col-md-8 col-md-offset-2 col-lg-8 col-lg-offset-0 navbar__menu navbar__mobilenavigation">
  
    

      
      <ul class="menu menu--menu-mobile-navbar nav">
                        <li>
        <a href="/news" data-drupal-link-system-path="news">News</a>
                  </li>
                        <li>
        <a href="/popular" data-drupal-link-system-path="popular">Popular</a>
                  </li>
                        <li>
        <a href="/recent" data-drupal-link-system-path="recent">Recent</a>
                  </li>
        </ul>
  

  </section>

  </div>

      </div>
          </header>
    </div>
  
</div>
  <div role="main" class="main-container container js-quickedit-main-content" id="main">
    <div class="row">

            
            
                  <section class="col-sm-12">

                                      <div class="highlighted">  <div class="region region-highlighted">
    <div data-drupal-messages-fallback class="hidden"></div>

  </div>
</div>
                  
                
                
                
                          <a id="main-content"></a>
            <div class="region region-content">
        <h1 class="page-header"><span>Stream Control Transmission Protocol (SCTP) Associations</span>
</h1>

  <div data-history-node-id="9749" class="row bs-2col-stacked node node--type-xmlnode node--view-mode-full">
  

    <div class="col-sm-12 bs-region bs-region--top">
    
      <div class="field field--name-field-tags field--type-entity-reference field--label-hidden field--items">
              <div class="field--item"><div about="/tag/howtos" typeof="schema:Thing">
  
      <h2><a href="/tag/howtos">
            <div property="schema:name" class="field field--name-name field--type-string field--label-hidden field--item">HOWTOs</div>
      </a></h2>
      <span property="schema:name" content="HOWTOs" class="hidden"></span>

  
</div>
</div>
          </div>
  
            <div class="field field--name-node-author field--type-ds field--label-hidden field--item">by Jan Newmarch</div>
      
            <div class="field field--name-node-post-date field--type-ds field--label-hidden field--item">on October 1, 2007</div>
      
  </div>
  
    <div class="col-sm-9 bs-region bs-region--left">
    
            <div class="field field--name-body field--type-text-with-summary field--label-hidden field--item"><div lang="en" xml:lang="en"><div lang="en" xml:lang="en"><div><a></a></div>

<p>
An SCTP association is a generalisation of a TCP connection. Usually a
TCP connection is one-to-one between two network interfaces, one on a
server and the other on a client. In contrast, an SCTP association is
many-to-many in two ways:
</p><div><ul type="disc"><li><p>
Multiple network interfaces on a server can be associated with multiple
interfaces on a client. For example, suppose the server and client both
have an Ethernet card and a Wi-Fi card connected to the Internet. Then,
data can flow over a single association in up to four possible ways:
Ethernet to Ethernet, Ethernet to Wi-Fi, Wi-Fi to Ethernet or Wi-Fi to
Wi-Fi.
</p></li><li><p>
An association also can carry multiple logical streams. These are
numbered from zero upward. So, for example, stream zero could carry
control instructions, while stream one could carry small pieces of data
(such as small files), and stream two could carry larger pieces of data
(such as an MPEG movie). The three streams are logically independent,
so that delays on one stream do not cause delays on any other stream.
</p></li></ul></div><p>
Note that a single socket can have multiple associations—that is, one
socket can be used to talk to multiple other hosts. In general, these
different associations are distinguished by having an association ID. The
socket API for SCTP distinguishes between situations where exactly one
association can exist (a one-to-one socket) or where a socket can manage
many associations (a one-to-many socket). The first case corresponds to
the TCP-like case that I discussed in the first article on SCTP
[<span class="emphasis"><em>LJ</em></span>, September 2007]. The
second case will be covered in the next article. In this article, I
look only at a single association, which is applicable to both
the one-to-one and the one-to-many sockets.
</p>

</div><div lang="en" xml:lang="en"><div><a></a>
Using a Subset of Network Interfaces</div><p>
TCP and UDP use a single network interface on an endpoint, by specifying
its IP address in a socketaddr structure. If you specify the wildcard
address INADDR_ANY, a server will listen on all interfaces while a
client will choose only one. In any case, communication takes place
only between a single interface on each endpoint. As an aside, if you want to
know what all the interfaces on your machine are, use the call ioctl()
with parameter SIOCGIFCONF. How to do this is described in WR Stevens
et al., <span class="emphasis"><em>Unix Network Programming</em></span>, vol 1, section
17.5.
</p><p>
Using only one interface reduces reliability when more than one is
available. A network cable may have poor connections, or you may be too
far from a wireless access point for a reliable signal. On the other hand,
using all of the interfaces may not always be desirable. For example,
in Australia, the download charges for 3-G or WiMAX connections
are ridiculously expensive, so you would use that interface only if no
others were available. Or, a bridge would expose the internal
and external interfaces separately to different groups of users.
</p><p>
SCTP allows an application to choose a subset of interfaces on either
the source or destination side of an association. Some implementations
also will allow interfaces to be added or removed dynamically, so the
application can adjust to different states of the network connections. By
registering for association-change events (which will be discussed in the
next article),
one endpoint can track changes in the interfaces at the other end.
</p><p>
The normal socket call bind() just takes a single sockaddr parameter
to bind the socket to a single IP address (or to the wildcard
address). SCTP extends this by introducing a new call, sctp_bindx(),
which takes an array of sockaddrs to bind the socket to all of these
addresses. The socket is bound only to a single port though; all of the
port numbers in the array of sockaddrs must have the same port
number. And, if addresses are added or removed later, they must have the
same bound port value. Otherwise, the call fails.
</p><p>
There is another wrinkle to sctp_bindx() regarding IPv4 and IPv6
addresses. The socket can be passed a set of only IPv4 sockaddrs, 
a set of only IPv6 sockaddrs or a mixture of both. The two types of socket
address structures, sockaddr_in and sockaddr_in6, have different sizes,
so mixing these in the same array can cause alignment issues. SCTP packs
the structures together with no wasted space between them. So, you can't
just use an index into the array, you have to copy the right number of
bytes for each structure and then move up by that amount.
</p><p>
The call to bind a set of addresses is:

</p><pre>int sctp_bindx(int sd, struct sockaddr *addrs, 
 ↪int addrcount, int flags)
</pre>
</div>

<div lang="en" xml:lang="en"><div><a></a></div><p>
where flags can be one of SCTP_BINDX_ADD_ADDR or SCTP_BINDX_REM_ADDR,
and the second parameter is a packed list of IPv4 and IPv6 socket
address structures.
</p><p>
It is relatively easy to use this on a server to allow clients to
connect on any of the server's bound interfaces. But, how do you do this
on a client? Where is the bind() operation? Well, just like TCP, this is
hidden under the covers. In TCP, if a call to connect() is made and the
socket is not yet bound (the usual case for a client), the TCP stack
will choose one of the interfaces and an ephemeral port. You can make
an explicit call to bind() that will let you choose the interface, but
usually the port is left as zero, so an ephemeral port is still chosen.
</p><p>
You can do exactly the same with SCTP—don't call bind() and leave it to
the SCTP stack. This will choose an ephemeral port like TCP, but instead
of using a single interface, it will choose a set of interfaces (probably
all that are available). So calling connect() without an initial bind() or
sctp_bindx() will give you multihoming on the client side automatically.
</p><p>
If you call bind() with a specified interface before connect() in the
client, you get only that single client-side interface, losing one
of the advantages of SCTP! If you call bind() with the wildcard address
INADDR_ANY, SCTP will choose a set of interfaces for you. So, SCTP
will try to give you multihoming unless you pin it down to a single
address using bind() or to a specific set of addresses using sctp_bindx().
</p><p>
With SCTP, I would expect a call to sctp_bindx() with all ports set
to zero to choose the same ephemeral port for all addresses. Instead,
the current Linux implementation (up to kernel 2.6.21) gets an ephemeral
port for the first address and then throws an error, because the ports in
the later addresses are still zero instead of this ephemeral value. The
workaround is to call bind() with one address with port zero, see what the
system set the port to, and then call bindx() on the remaining addresses
with this new port number. Listing 1 (multi_homed_client.c) shows an
example of this. This workaround probably will become unnecessary in the
next specification of SCTP following discussion on the SCTP mailing list.

</p></div><div lang="en" xml:lang="en"><div><a></a></div><div><p><b>
Listing 1. multi_homed_client.c</b></p><pre>
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;netinet/in.h&gt;

#include &lt;netinet/sctp.h&gt;

int main(int argc, char *argv[]) {
      int sockfd;
      int n;
      struct sockaddr_in addr, *addresses;
      int addr_size = sizeof(struct sockaddr_in);
      int addr_count = argc - 2;
      int port;

      if (argc &lt; 2) {
          fprintf(stderr, "Usage %s client-addresses...\n", argv[0]);
          exit(1);
      }

      /* create endpoint */
      sockfd = socket(AF_INET, SOCK_STREAM,
                      IPPROTO_SCTP);
      if (sockfd &lt; 0) {
              perror("socket");
              exit(2);
      }

      addresses = malloc(addr_size * addr_count);
      if (addresses == NULL) {
              perror("malloc");
              exit(1);
      }

      /* do bind to get ephemeral port first */
      addr.sin_family = AF_INET;
      addr.sin_addr.s_addr = inet_addr(argv[1]);
      addr.sin_port = 0;
      if (bind(sockfd, (struct sockaddr *) &amp;addr, addr_size) == -1) {
              perror("bind");
              exit(1);
      }

      /* this gets sin.sin_port so we can find the ephemeral port */
      getsockname(sockfd, (struct sockaddr *) &amp;addr, &amp;addr_size);
      port = addr.sin_port;
      printf("Ephemeral port is %d\n", port);


      for ( n = 2; n &lt; argc; n++) {
              addr.sin_family = AF_INET;
              addr.sin_addr.s_addr = inet_addr(argv[n]);
              addr.sin_port = port;

              memcpy(addresses + (n-2), &amp;addr, addr_size);
      }

      if (sctp_bindx(sockfd, (struct sockaddr *) addresses, addr_count,
                     SCTP_BINDX_ADD_ADDR) == -1) {
              perror("sctp bindx");
              exit(2);
      }

      /* get local list */
      addr_count = sctp_getladdrs(sockfd, 0, (struct sockaddr**)&amp;addresses);
      for (n = 0; n &lt; addr_count; n++) {
              memcpy(&amp;addr, addresses+n, addr_size);
              printf("addr %s, port %d\n",
                     inet_ntoa(addr.sin_addr.s_addr),
                     addr.sin_port);
      }

      /* we don't actually connect to any server in this program */
      close(sockfd);
      exit(0);
}

</pre></div></div><div lang="en" xml:lang="en"><div><a></a>
Using Multiple Interfaces</div><p>
You can set the local interfaces to be used by sctp_bindx(). A client
also can specify the subset of addresses that it wants to use to connect
to the server by using the call sctp_connectx(), which takes a list of
socket address structures just like sctp_bindx(). Why do this? Well,
using connect() with a single address is a possible point of failure at
the time that the initial connection is done. This is what the function
sctp_connectx() solves. It allows the client to try multiple addresses
in order to connect to the server.
</p><p>
The set of addresses in sctp_connectx() is used just to make the initial
connection. But, after the connection is established, an interchange
of information takes place between the two endpoints. In that exchange,
the remote peer tells the local peer which addresses it actually wants
to use and vice versa. The set of remote addresses that the remote
peer will use need not be the same as what the client used in the connection.
However,
you at least can assume that one (but you don't know which one) of the
addresses passed to sctp_connectx() will appear in the list that the
remote peer offers, because the local client had to connect to something!
</p><p>
So, if the remote peer chooses the set of addresses it uses, how does the
local client find which ones they are? This is done by another function,
sctp_getpaddrs(), that gives the set of remote peer addresses. There is
also an sctp_getladdrs() function, in case the local peer forgets which
addresses it is using!
</p><p>
Once an association is set up between two endpoints, messages can be sent
between them. Note that SCTP does not concern itself with QoS
(Quality-of-Service) issues, such as real-time delivery, but only with
reliability issues. SCTP uses the multihomed capabilities to try as many
possible routes as possible to get messages through. So on the sending
side, there is no control over which interfaces are used; indeed, the
sender might even use a scheme such as round-robin among its interfaces
for each message. However, the sending application can indicate to its
SCTP stack which of the remote peer's interface it would prefer to use,
and it can tell the remote peer on which interfaces it would prefer to receive
messages. These are done by using the setsockopt() call with option
type as SCTP_PRIMARY_ADDR or SCTP_SET_PEER_PRIMARY_ADDR. Of course,
if these particular addresses are not available, SCTP simply will use
different addresses in the association.
</p><p>
Once SCTP is told which interfaces to use, it basically looks after
things itself. It uses heartbeats to keep track of which interfaces are
alive, and it switches interfaces transparently when failure occurs. This
is to satisfy the design goals of SCTP for improved reliability over
TCP. Applications can give hints to the SCTP stack about which interfaces
to use, but the stack will ignore these hints on failure.
</p></div>

<div lang="en" xml:lang="en"><div><a></a>
Streams</div><p>
In TCP, a stream is just a sequence of bytes. In SCTP, it has a different
meaning; a stream is a logical channel along which messages are sent,
and a single association can have many streams. The original motivation
for streams came from the telephony domain, where multiple reliable
channels were needed, but the messages on each channel were independent
of those on other channels. In last month's article, we pointed out some
TCP applications that could benefit from streams, such as FTP, which
uses two sockets for data and control messages. In addition, 
an increasing number of applications are multithreaded, and
streams open up the possibility of a thread in one peer being able to
communicate with a thread in another peer without worrying about being
blocked by messages sent by other threads.
</p><p>
The socket I/O calls read/write/send/recv do not know about SCTP
streams. By default, the write calls all use stream number zero (this
can be changed by a socket option), but the read calls will read messages
on all streams, and there is no indication as to which stream is used. So, to
use streams effectively, you need to use some of the I/O calls that are
designed specifically for SCTP.
</p></div><div lang="en" xml:lang="en"><div><a></a>
Negotiating the Number of Streams</div><p>
Each endpoint of an association will support a certain number of
streams. A Linux endpoint, by default, will expect to be able to send to
ten streams, while it can receive on 65,535 streams. Other SCTP stacks may
have different default values. These values can be changed by setting
the socket option SCTP_INITMSG, which takes a structure sctp_initmsg:

</p><pre>struct sctp_initmsg { 
    uint16_t sinit_num_ostreams; 
    uint16_t sinit_max_ostreams; 
    uint16_t sinit_max_attempts; 
    uint16_t sinit_max_init_timeo; 
}
</pre>
<p>
If this socket option is used to set values, it must be done before
an association is made. The parameters will be sent to the peer endpoint
during association initialisation.
</p><p>
Each endpoint in an association will have an idea of how many input and
output streams it will allow on an association, as discussed in the
previous
paragraph. During the establishment of the association, the endpoints
exchange these values. Negotiation of final values is just a matter of
taking the minimum values. If one end wants 20 output streams, and the
other wants only 10 input streams, the result is the smaller, 10,
and similarly for the number of streams in the opposite direction.
</p><p>
An endpoint will need to know how many output streams are available for
writing in order not to exceed the limits. This value is determined
during association setup. After setup, the endpoint can find this by
making a query using getsockopt(). However, there is a little wrinkle
here: a socket may have many associations (to different endpoints),
and each association may have set different values. So, we have to make
a query that asks for the parameters for a particular association,
not just for the socket. The parameter to ask for is SCTP_STATUS, which
takes a structure of type sctp_status:

</p><pre>struct sctp_status { 
       sctp_assoc_t    sstat_assoc_id; 
       int32_t         sstat_state; 
       uint32_t        sstat_rwnd; 
       uint16_t        sstat_unackdata; 
       uint16_t        sstat_penddata; 
       uint16_t        sstat_instrms; 
       uint16_t        sstat_outstrms; 
       uint32_t        sstat_fragmentation_point; 
       struct sctp_paddrinfo sstat_primary; 
};
</pre>
<p>
This has fields sstat_instrms and sstat_outstrms, which contain the
required information. See Listings 2 
and 3 for a client and server
negotiating the number of streams in each direction.

</p></div><div lang="en" xml:lang="en"><div><a></a></div><div><p><b>
Listing 2. streamcount_echo_client.c</b></p><pre>
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;netinet/in.h&gt;

#include &lt;netinet/sctp.h&gt;

#define ECHO_PORT 2013

char *usage_msg = "usage: astreamcount_echo_client ip-addr istreams
  ostreams";

char *msg = "hello";

void usage() {
        fprintf(stderr, "%s\n", usage_msg);
        exit(1);
}

int main(int argc, char *argv[]) {
        int sockfd;
        int len;
        struct sockaddr_in serv_addr;
        int port = ECHO_PORT;
        struct sctp_initmsg initmsg;
        struct sctp_status status;

        if (argc != 4) usage();

        /* create endpoint */
        sockfd = socket(AF_INET, SOCK_STREAM,
                        IPPROTO_SCTP
                );

        if (sockfd &lt; 0) {
                perror("socket creation");
                exit(2); }
        /* connect to server */
        serv_addr.sin_family = AF_INET;
        serv_addr.sin_addr.s_addr = inet_addr(argv[1]);
        serv_addr.sin_port = htons(port);

        memset(&amp;initmsg, 0, sizeof(initmsg));
        initmsg.sinit_max_instreams = atoi(argv[2]);
        initmsg.sinit_num_ostreams = atoi(argv[3]);
        printf("Asking for: input streams: %d, output streams: %d\n",
               initmsg.sinit_max_instreams,
               initmsg.sinit_num_ostreams);

        if (setsockopt(sockfd, IPPROTO_SCTP,
                       SCTP_INITMSG, &amp;initmsg, sizeof(initmsg))) {
                perror("set sock opt\n");
        }

        if (connect(sockfd, (struct sockaddr *) &amp;serv_addr,
                    sizeof(serv_addr)) &lt; 0) {
                perror("connectx");
                exit(3);
        }

        len = sizeof(status);
        memset(&amp;status, 0, len);

        if (getsockopt(sockfd, IPPROTO_SCTP,
                       SCTP_STATUS, &amp;status, &amp;len) == -1) {
                perror("get sock opt");
        }
        printf("Got: input streams: %d, output streams: %d\n",
               status.sstat_instrms,
               status.sstat_outstrms);


        /* give the server time to do something */
        sleep(2);

        /* no reads/writes are done */
        close(sockfd);
        exit(0);
}

</pre></div></div>

<div lang="en" xml:lang="en"><div><a></a></div><div><p><b>
Listing 3. streamcount_echo_server.c</b></p><pre>
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;netinet/in.h&gt;

#include &lt;netinet/sctp.h&gt;

#define ECHO_PORT 2013

char *usage_msg = "usage: streamcount_echo_server istreams ostreams";

void usage() {
        fprintf(stderr, "%s\n", usage_msg);
        exit(1);
}


int main(int argc, char *argv[]) {
        int sockfd, client_sockfd;
        int len;
        struct sockaddr_in serv_addr, client_addr;
        int port = ECHO_PORT;
        struct sctp_initmsg initmsg;
        struct sctp_status status;

        if (argc != 3) usage();

        /* create endpoint */
        sockfd = socket(AF_INET, SOCK_STREAM,
                        IPPROTO_SCTP
                );
        if (sockfd &lt; 0) {
                perror("socket");
                exit(2);
        }

        serv_addr.sin_family = AF_INET;
        serv_addr.sin_addr.s_addr = INADDR_ANY;
        serv_addr.sin_port = htons(port);

        if (bind(sockfd, (struct sockaddr *) &amp;serv_addr,
                 sizeof(serv_addr)) == -1) {
                perror("sctp bind");
                exit(2);
        }


        memset(&amp;initmsg, 0, sizeof(initmsg));
        initmsg.sinit_max_instreams = atoi(argv[1]);
        initmsg.sinit_num_ostreams = atoi(argv[2]);
        printf("Asking for: input streams: %d, output streams: %d\n",
               initmsg.sinit_max_instreams,
               initmsg.sinit_num_ostreams);

        if (setsockopt(sockfd, IPPROTO_SCTP,
                       SCTP_INITMSG, &amp;initmsg, sizeof(initmsg))) {
                perror("set sock opt\n");
        }

        /* specify queue */
        listen(sockfd, 5);
        for (;;) {
                len = sizeof(client_addr);
                client_sockfd = accept(sockfd, (struct sockaddr *)
&amp;client_addr, &amp;len);
                if (client_sockfd == -1) {
                        perror(NULL); continue;
                }

                memset(&amp;status, 0, sizeof(status));
                len = sizeof(status);
                if (getsockopt(client_sockfd, IPPROTO_SCTP,
                               SCTP_STATUS, &amp;status, &amp;len) == -1) {
                        perror("get sock opt");
                }
                printf("Got: input streams: %d, output streams: %d\n",
                       status.sstat_instrms,
                       status.sstat_outstrms);

                /* give the client time to do something */
                sleep(2);
                close(client_sockfd);

        }
}

</pre></div></div><div lang="en" xml:lang="en"><div><a></a>
Association ID</div><p>
For the one-to-one socket we discussed in the first article in this
series, there can be only one association at any time. For the one-to-many
sockets we will cover in the next article, there can be many associations
active at any one time—a peer can be connected to many other peers
simultaneously. This is different from TCP where only one connection on
a socket can exist and also is different from UDP where no connections exist
and messages are just sent to arbitrary peers.
</p><p>
When there can be many associations, you need to be able to distinguish
between them. This is done by an opaque data type called an association
ID. You need to use this sometimes, but not every time. For one-to-one
sockets, there is only one association, so the association ID is always
ignored. For one-to-many sockets, when the association is
“obvious”,
the association ID again is ignored. This occurs, for example, when you
write to a peer and give the peer's socket address; there can 
be only one association to a peer (but many associations to many peers),
so if the peer is known, the association is known, and there is no
need for the ID. But the association ID has to be used when the SCTP
stack cannot work out for itself which association is meant. One place
where this happens is in the getsockopt() call described previously to find
the number of streams of an association on a one-to-many socket. I will
defer the discussion of how to find the association ID to the next article,
where I look at one-to-many sockets.
</p></div><div lang="en" xml:lang="en"><div><a></a>
Writing to and Reading from a Stream</div><p>
There are several ways of writing to a stream and telling to which
stream a read belongs. Some of them make use of a structure of type
sctp_sndrcvinfo:

</p><pre>struct sctp_sndrcvinfo { 
      uint16_t sinfo_stream; 
      uint16_t sinfo_ssn; 
      uint16_t sinfo_flags; 
      uint32_t sinfo_ppid; 
      uint32_t sinfo_context; 
      uint32_t sinfo_timetolive; 
      uint32_t sinfo_tsn; 
      uint32_t sinfo_cumtsn; 
      sctp_assoc_t sinfo_assoc_id; 
}
</pre>
<p>
Most of the fields in this structure are not of interest to us at the
moment. The interesting one is the first one, sinfo_stream. To write
to a particular stream, zero out all fields and set this one; to read,
zero out all fields again, do the read, and then examine this field. (As
an
aside, if the SCTP stack cannot work out which association is meant, 
the last field, sinfo_assoc_id, must be set.)
</p><p>
The function call to write a message is:

</p><pre>int sctp_send(int sd, 
              const void *msg, 
              size_t len, 
              const struct sctp_sndrcvinfo *sinfo, 
              int flags);
</pre>
</div>

<div lang="en" xml:lang="en"><div><a></a></div><p>
where the field sinfo_stream of sinfo has been set. 
</p><p>
The call to read is, conversely:

</p><pre>ssize_t sctp_recvmsg(int sd, 
                     void *msg, 
                     size_t len, 
                     struct sockaddr *from, 
                     socklen_t *fromlen 
                     struct sctp_sndrcvinfo *sinfo 
                     int *msg_flags)
</pre>
</div><div lang="en" xml:lang="en"><div><a></a></div><p>
The stream number is then available in sinfo.sinfo_stream. 
</p><p>
The SCTP stack keeps a lot of information about each message that
passes between peers. It also keeps information about the state of each
association. To avoid overloading applications, most of this information
is suppressed and is not passed to the application. In particular,
by default, the structure sctp_sndrcvinfo is not filled in, so a reader
cannot tell on which stream a read occurred! To enable this to be filled,
a socket option must be called first as:

</p><pre>
struct sctp_event_subscribe events; 
bzero(&amp;events, sizeof(events)); 
events.sctp_data_io_event = 1; 
setsockopt(sockfd, IPPROTO_SCTP, 
           SCTP_EVENTS, &amp;events, sizeof(events));

</pre>
<p>
(More details on SCTP events will be given in the next article.) See
Listings 4 (streamsend_echo_client.c) and 5 (streamsend_echo_server.c)
for an example of a client and server using a specific stream for
communication.
.
</p></div><div lang="en" xml:lang="en"><div><a></a></div><div><p><b>
Listing 4. streamsend_echo_client.c</b></p><pre>
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;netinet/in.h&gt;

#include &lt;netinet/sctp.h&gt;

#define SIZE 1024
char buf[SIZE];
#define ECHO_PORT 2013

char *usage_msg = "usage: streamsend_echo_client ip-addr istreams
ostreams stream";

void usage() {
        fprintf(stderr, "%s\n", usage_msg);
        exit(1);
}


int main(int argc, char *argv[]) {
        int sockfd;
        int len;
        struct sockaddr_in serv_addr;
        struct sockaddr_in *addresses;
        int addr_size = sizeof(struct sockaddr_in);
        int addr_count = argc - 1;
        int port = ECHO_PORT;

        char *message = "hello\n";
        struct sctp_initmsg initmsg;
        struct sctp_status status;
        struct sctp_sndrcvinfo sinfo;
        int ochannel;

        if (argc != 5) usage();

        /* create endpoint */
        sockfd = socket(AF_INET, SOCK_STREAM,
                        IPPROTO_SCTP
                );

        if (sockfd &lt; 0) {
                perror(NULL);
                exit(2); }
        /* connect to server */
        addresses = malloc(addr_size);
        if (addresses == NULL) {
                exit(1);
        }

        serv_addr.sin_family = AF_INET;
        serv_addr.sin_addr.s_addr = inet_addr(argv[1]);
        serv_addr.sin_port = htons(port);

        memcpy(addresses, &amp;serv_addr, addr_size);

        memset(&amp;initmsg, 0, sizeof(initmsg));
        initmsg.sinit_max_instreams = atoi(argv[2]);
        initmsg.sinit_num_ostreams = atoi(argv[3]);
        printf("Asking for: input streams: %d, output streams: %d\n",
               initmsg.sinit_max_instreams,
               initmsg.sinit_num_ostreams);

        if (setsockopt(sockfd, IPPROTO_SCTP,
                       SCTP_INITMSG, &amp;initmsg, sizeof(initmsg))) {
                perror("set sock opt\n");
        }

        if (sctp_connectx(sockfd, (struct sockaddr *) addresses, 1) &lt; 0)
{
                perror("connectx");
                exit(3);
        }

        memset(&amp;status, 0, sizeof(status));
        len = sizeof(status);
        status.sstat_assoc_id = 1;

        if (getsockopt(sockfd, IPPROTO_SCTP,
                       SCTP_STATUS, &amp;status, &amp;len) == -1) {
                perror("get sock opt\n");
        }
        printf("Got: input streams: %d, output streams: %d\n",
               status.sstat_instrms,
               status.sstat_outstrms);

        /* sanity check channel */
        ochannel = atoi(argv[4]);
        if (ochannel &gt;= status.sstat_outstrms)
                printf("Writing on illegal channel %d\n", ochannel);

        /* transfer data */
        bzero(&amp;sinfo, sizeof(sinfo));
        sinfo.sinfo_stream = ochannel;
        sctp_send(sockfd, message, strlen(message),
                  &amp;sinfo, 0);

        sinfo.sinfo_flags = SCTP_EOF;
        sctp_send(sockfd, NULL, 0,
                  &amp;sinfo, 0);

        close(sockfd);
        exit(0);
}

</pre></div></div><div lang="en" xml:lang="en"><div><a></a></div><div><p><b>
Listing 5. streamsend_echo_server.c</b></p><pre>
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;netinet/in.h&gt;

#include &lt;netinet/sctp.h&gt;

#define SIZE 1024
char buf[SIZE];
#define TIME_PORT 2013

char *usage_msg = "usage: app ip-addr istreams ostreams";

void usage() {
  fprintf(stderr, "%s\n", usage_msg);
  exit(1);
}


int main(int argc, char *argv[]) {
  int sockfd, client_sockfd;
  int nread, len;
  struct sockaddr_in serv_addr, client_addr;
  time_t t;
  struct sockaddr_in *addresses;
  int addr_size = sizeof(struct sockaddr_in);
  int addr_count = 1;
  int port = TIME_PORT;
  int n;
  struct sctp_initmsg initmsg;
  struct sctp_status status;
  sctp_assoc_t associd;
  struct sctp_sndrcvinfo sinfo;
  struct sctp_event_subscribe events;

  int flags;

  if (argc != 4) usage();

  /* create endpoint */
  sockfd = socket(AF_INET, SOCK_STREAM,
                 IPPROTO_SCTP
  );
  if (sockfd &lt; 0) {
    perror(NULL);
    exit(2);
  }

  serv_addr.sin_family = AF_INET;
  serv_addr.sin_addr.s_addr = inet_addr(argv[1]);
  serv_addr.sin_port = htons(port);

  if (sctp_bindx(sockfd, (struct sockaddr *) &amp;serv_addr, addr_count,
                 SCTP_BINDX_ADD_ADDR) == -1) {
    perror("sctp bindx");
    exit(2);
  }

  memset(&amp;initmsg, 0, sizeof(initmsg));
  initmsg.sinit_max_instreams = atoi(argv[2]);
  initmsg.sinit_num_ostreams = atoi(argv[3]);
  printf("Asking for: input streams: %d, output streams: %d\n",
         initmsg.sinit_max_instreams,
         initmsg.sinit_num_ostreams);

  if (setsockopt(sockfd, IPPROTO_SCTP,
                 SCTP_INITMSG, &amp;initmsg, sizeof(initmsg))) {
    perror("set sock opt\n");
  }



  /* specify queue */
  listen(sockfd, 5);
  for (;;) {
    len = sizeof(client_addr);
    client_sockfd = accept(sockfd, (struct sockaddr *) &amp;client_addr,
&amp;len);
    if (client_sockfd == -1) {
      perror(NULL); continue;
    }



    memset(&amp;status, 0, sizeof(status));
    len = sizeof(status);
    status.sstat_assoc_id = 0;

    if (getsockopt(client_sockfd, IPPROTO_SCTP,
                   SCTP_STATUS, &amp;status, &amp;len) == -1) {
      perror("get sock opt\n");
    }

    printf("Got: input streams: %d, output streams: %d\n",
           status.sstat_instrms,
           status.sstat_outstrms);


    for(;;) {
      /* transfer data */
      len = sizeof(client_addr);
      bzero(&amp;sinfo, sizeof(sinfo));
      nread = sctp_recvmsg(client_sockfd, buf, SIZE,
                           (struct sockaddr *) &amp;client_addr, &amp;len,
                         &amp;sinfo, &amp;flags);

      if (nread == 0) {
        break;
      }

      printf("read %d bytes on channel %hd\n", nread,
sinfo.sinfo_stream);
      printf("sinfo flags: %d\n", sinfo.sinfo_flags);
      write(1, buf, nread);
    }
    close(client_sockfd);
  }
}

</pre></div><p>
There is no way to specify from which stream to read. This is deliberate;
the intention is that when data is ready on any stream, then you read it.
Otherwise, data could be blocked on a stream with no one to read it, which
eventually could fill up system buffers. So, you can't restrict reading
to any particular stream. But, once a read is done, you can tell which
stream it has come from by using the mechanism above.
</p><p>
Typically, a server that reads and handles a message will have
(pseudocode) that looks like this:

</p><pre>
while (true) { 
    nread = sctp_recvmsg(..., msg, ..., &amp;sinfo, ...) 
    if (nread &lt;= 0) break; 
    assoc_id = sinfo.sinfo_assoc_id; 
    stream = sinfo.sinfo_stream; 
    handle_mesg(assoc_id, stream, msg, nread); 
}

</pre>
<p>
This is a single-threaded read loop. It ensures that information is read,
no matter what association or stream it is sent on. The application
function handle_mesg() can, of course, dispatch the message to different
threads if it wants. Writes, on the other hand can be sent from multiple
threads if desired.
</p></div>

<div lang="en" xml:lang="en"><div><a></a>
Conclusion</div><p>
This article has discussed a feature novel to SCTP, streams. A stream
allows multiple data channels on a single association. This avoids a major
problem of TCP, head-of-line blocking, but it also allows applications
that
deal with multiple logical streams to be written more easily. The next
and final
article will look at how SCTP can handle multiple associations at once,
simplifying the TCP model and also offering improvements over the UDP
connection model.
</p></div></div>
<div><p>
Jan Newmarch is Honorary Senior Research Fellow at Monash University. He
has been using Linux since kernel 0.98. He has written four books and many
papers and given courses on many technical topics, concentrating on
network programming for the last six years. His Web site is
<a href="http://jan.newmarch.name">jan.newmarch.name</a>.
</p></div></div>
      
    <section class="section--disqus">
    <a id="comments-link" class="btn btn-default" href="https://www.linuxjournal.com/article/9749#disqus_thread">Load Disqus comments</a>

    <div id="disqus_thread"></div>
  <noscript>Our discussions are <a href="https://disqus.com/?ref_noscript" rel="nofollow">powered by Disqus</a>, which require JavaScript.</noscript>

    
</section>
  </div>
  
    <div class="col-sm-3 bs-region bs-region--right">
    
            <div class="field field--name-dynamic-block-fieldnode-sidebar-image field--type-ds field--label-hidden field--item"><div class="views-element-container form-group"><div class="view view-sidebar-image view-id-sidebar_image view-display-id-block_1 js-view-dom-id-a6e35fafc8ba1e00f0dd245e251ee862c99b1d68cc437c8c0325a0e30db3218e">
  
    
      
      <div class="view-content">
          <div class="views-row">
            <div class="field field--name-body field--type-text-with-summary field--label-hidden field--item"><p><a href="https://www.linode.com/lp/brand-free-credit/?utm_source=linux_journal&amp;utm_medium=dis[…]mpaign=display-linux_journal-side_rail&amp;utm_content=&amp;utm_term=" rel="nofollow" target="blank"><img alt="Linode Predictable Cloud" data-entity-type="file" data-entity-uuid="14963619-bd1f-413f-9abc-b94f8a1e1ecf" src="/sites/default/files/inline-images/linode_predictable_cloud.png" /></a></p>
<p> </p>
</div>
      </div>

    </div>
  
          </div>
</div>
</div>
      
            <div class="field field--name-dynamic-block-fieldnode-related-articles field--type-ds field--label-hidden field--item"><div class="views-element-container form-group"><div class="view view-related-content view-id-related_content view-display-id-block_1 js-view-dom-id-8d9911fa05eca3653784455b7115f10b271fa2241ff5b1dce5120eab5192a4ba">
  
    
      <div class="view-header">
      <h2>You May Like</h2>
    </div>
      
      <div class="view-content">
          <div class="views-row"><div class="views-field views-field-field-node-image"><div class="field-content">  <a href="/content/running-gnome-container"><img src="/sites/default/files/styles/75x75_square/public/nodeimage/story/bigstock-Container-Ship-In-Export-And-I-300095251_0.jpg?itok=5Sd3cn2G" width="75" height="75" alt="&quot;&quot;" typeof="foaf:Image" class="img-responsive" />

</a>
</div></div><div class="views-field views-field-title"><span class="field-content"><a href="/content/running-gnome-container" hreflang="en">Running GNOME in a Container</a></span></div><div class="views-field views-field-uid"><span class="field-content"><a href="/users/adam-verslype" hreflang="en">Adam Verslype</a></span></div></div>
    <div class="views-row"><div class="views-field views-field-field-node-image"><div class="field-content">  <a href="/content/digital-will-part-i-requirements"><img src="/sites/default/files/styles/75x75_square/public/nodeimage/story/bigstock-Will-Concept--Paperwork-Repre-267778912.jpg?itok=FDp9v5I7" width="75" height="75" alt="last will and testament" typeof="foaf:Image" class="img-responsive" />

</a>
</div></div><div class="views-field views-field-title"><span class="field-content"><a href="/content/digital-will-part-i-requirements" hreflang="en">Digital Will, Part I: Requirements</a></span></div><div class="views-field views-field-uid"><span class="field-content"><a href="/users/kyle-rankin" hreflang="en">Kyle Rankin</a></span></div></div>
    <div class="views-row"><div class="views-field views-field-field-node-image"><div class="field-content">  <a href="/content/build-your-own-internet-radio-receiver"><img src="/sites/default/files/styles/75x75_square/public/nodeimage/story/12693f1smaller.png?itok=HJuJw-sa" width="75" height="75" alt="DIY Internet Radio Receiver" typeof="foaf:Image" class="img-responsive" />

</a>
</div></div><div class="views-field views-field-title"><span class="field-content"><a href="/content/build-your-own-internet-radio-receiver" hreflang="en">Build Your Own Internet Radio Receiver</a></span></div><div class="views-field views-field-uid"><span class="field-content"><a href="/users/nick-tufillaro" hreflang="en">Nick Tufillaro</a></span></div></div>
    <div class="views-row"><div class="views-field views-field-field-node-image"><div class="field-content">  <a href="/content/testing-models"><img src="/sites/default/files/styles/75x75_square/public/nodeimage/story/BinaryData50_1.jpg?itok=DBm0ULN_" width="75" height="75" alt="" typeof="foaf:Image" class="img-responsive" />

</a>
</div></div><div class="views-field views-field-title"><span class="field-content"><a href="/content/testing-models" hreflang="und">Testing Models</a></span></div><div class="views-field views-field-uid"><span class="field-content"><a href="/users/reuven-m-lerner" hreflang="en">Reuven M. Lerner</a></span></div></div>

    </div>
  
          </div>
</div>
</div>
      
            <div class="field field--name-dynamic-block-fieldnode-sponsors field--type-ds field--label-hidden field--item"><div class="views-element-container form-group"><div class="view view-latest-sponsor-block view-id-latest_sponsor_block view-display-id-block_1 js-view-dom-id-6b0c918ed1395a227d2abc9f887ed17470f472be3a102bd0c381dd1d33b12f9a">
  
    
      <div class="view-header">
      
    </div>
      
      <div class="view-content">
          <div class="views-row">
            <div class="field field--name-body field--type-text-with-summary field--label-hidden field--item"><p><a href="https://www.linode.com/lp/brand-free-credit/?utm_source=linux_journal&amp;utm_medium=dis[…]mpaign=display-linux_journal-side_rail&amp;utm_content=&amp;utm_term=" rel="nofollow" target="blank"><img alt="Linode Predictable Cloud" data-entity-type="file" data-entity-uuid="14963619-bd1f-413f-9abc-b94f8a1e1ecf" src="/sites/default/files/inline-images/linode_predictable_cloud.png" /></a></p>
<p> </p>
</div>
      </div>

    </div>
  
          </div>
</div>
</div>
      
  </div>
  
  
</div>



  </div>

              </section>

                </div>
  </div>

      <footer class="footer container" role="contentinfo">
        <div class="region region-footer">
    <section class="views-element-container block block-views block-views-blocknewsletter-promo-block-block-1 clearfix" id="block-views-block-newsletter-promo-block-block-1">
  
    

      <div class="form-group"><div class="view view-newsletter-promo-block view-id-newsletter_promo_block view-display-id-block_1 js-view-dom-id-04d84b57ed181644b0193c08c32dcccaa248f320257c20fe3128f989646240d7">
  
    
      
      <div class="view-content">
          <div class="views-row">
            <div class="field field--name-body field--type-text-with-summary field--label-hidden field--item"><div class="newsletter-bottom">
<div class="col-md-9 col-sm-12 signup-form">
<!--<h3>Linux Journal Week in Review</h3>
<p>Sign up to get all the good stuff delivered to your inbox every week.</p>


<form id="subForm" class="js-cm-form" action="https://www.createsend.com/t/subscribeerror?description=" method="post" data-id="A61C50BEC994754B1D79C5819EC1255CDBC34DDF3E170B13E2BAC2D68C42BF424F853383C84F5BAE38EAB4CFA5C73907CAC074FF8192503AF80F3699F7FE5CE1">	
<div class="flexform">-->
    <!--<label for="fieldEmail">Email</label>
    <br />-->
    <!--<input id="fieldEmail" name="cm-gjjtdh-gjjtdh" type="email" class="js-cm-email-input" placeholder="Enter your email. Get the newsletter." 
    required />

    <button class="js-cm-submit-button" type="submit">Sign Up</button>
</div>
<div>
    <input id="cm-privacy-consent" name="cm-privacy-consent" required type="checkbox"
    />
    <label for="cm-privacy-consent">I give my consent to be emailed</label>
    <input id="cm-privacy-consent-hidden"
    name="cm-privacy-consent-hidden" type="hidden" value="true" />
</div>

</form>
<script type="text/javascript" src="https://js.createsend1.com/javascript/copypastesubscribeformlogic.js"></script>
</div>-->
<!--<div class="col-md-3 col-sm-12 subs-callout">
<img src="/sites/default/files/styles/large/public/2019-01/LJ294-Jan2019-Cover_0.jpg" width="100px" />

<h3>The Value of Open Source Journalism</h3>
<p>
Subscribe and support our coverage for technology's biggest thinkers – with up to 52% savings.
</p>
<strong><a href="https://www.linuxjournal.com/subscribe">Subscribe <i class="fa fa-angle-double-right" aria-hidden="true"></i></a> 
</strong>



</div>-->
</div>

</div>
      </div>

    </div>
  
          </div>
</div>

  </section>


  </div>

      		<div class="footer-blocks col-sm-12">
                <div class="col-md-6 col-sm-12 footer-left">
                        <div class="region region-footer-left">
    <section id="block-connectwithusfooter" class="block block-block-content block-block-content5e722bd4-5e08-454b-8507-956089bfa661 clearfix">
  
    

      
            <div class="field field--name-body field--type-text-with-summary field--label-hidden field--item"><div class="footer-heading">Connect With Us <span class="social-media"><a href="https://youtube.com/linuxjournalonline"  alt="Linux Journal on YouTube"><i class="fa fa-youtube fa-2x"></i></a><a href="https://www.facebook.com/linuxjournal/" alt="Linux Journal on Facebook"><i class="fa fa-facebook-f fa-2x"></i><a href="https://twitter.com/linuxjournal" alt="Linux Journal on Twitter"><i class="fa fa-twitter fa-2x"></i></a></span></div>

<p>Linux Journal, representing 25+ years of publication, is the original magazine of the global Open Source community.</p></div>
      
  </section>

<section id="block-linuxjournal-block-9" class="block block-block-content block-block-content8669793b-e217-4426-a79e-eb3c21ede127 clearfix">
  
    

      
            <div class="field field--name-body field--type-text-with-summary field--label-hidden field--item"><div id="copyright">© 2022 Slashdot Media, LLC. All rights reserved.</div>
</div>
      
  </section>

<section id="block-privacyterms" class="block block-block-content block-block-contenta203b8bd-80ef-4982-bf6e-784dd7b44120 clearfix">
  
    

      
            <div class="field field--name-body field--type-text-with-summary field--label-hidden field--item"><ul class="menu menu--footer-submenu nav" id="terms-nav">
	<li><a href="https://slashdotmedia.com/privacy-statement/" rel="nofollow" target="_blank">PRIVACY POLICY</a></li>
	<li><a href="https://slashdotmedia.com/terms-of-use/" rel="nofollow" target="_blank">TERMS OF SERVICE</a></li>
	<li><a href="/sponsors">ADVERTISE</a></li>
</ul></div>
      
  </section>


  </div>

                  </div>
        
        		<div class="col-md-4 col-sm-8 footer-middle">
                        <div class="region region-footer-middle">
    <nav role="navigation" aria-labelledby="block-footermenucolumn2-menu" id="block-footermenucolumn2">
            
  <h2 class="visually-hidden" id="block-footermenucolumn2-menu">Footer Menu Column 2</h2>
  

        
      <ul class="menu menu--footer-menu-column-2 nav">
                        <li>
        <a href="/content/masthead" data-drupal-link-system-path="node/1007727">Masthead</a>
                  </li>
                        <li>
        <a href="/author" data-drupal-link-system-path="node/1009249">Authors</a>
                  </li>
                        <li>
        <a href="/form/contact" data-drupal-link-system-path="webform/contact">Contact Us</a>
                  </li>
        </ul>
  

  </nav>
<nav role="navigation" aria-labelledby="block-footermenucolumn3-menu" id="block-footermenucolumn3">
            
  <h2 class="visually-hidden" id="block-footermenucolumn3-menu">Footer Menu Column 3</h2>
  

        
      <ul class="menu menu--footer-menu-column-3 nav">
                        <li>
        <a href="/rss_feeds" data-drupal-link-system-path="node/1000457">RSS Feeds</a>
                  </li>
                        <li>
        <a href="/aboutus" data-drupal-link-system-path="node/1000267">About Us</a>
                  </li>
        </ul>
  

  </nav>

  </div>

                  </div>
        
                </div>
    </footer>
  
</div> 
  </div>

    
    <script type="application/json" data-drupal-selector="drupal-settings-json">{"path":{"baseUrl":"\/","scriptPath":null,"pathPrefix":"","currentPath":"node\/9749","currentPathIsAdmin":false,"isFront":false,"currentLanguage":"en"},"pluralDelimiter":"\u0003","bootstrap":{"forms_has_error_value_toggle":1,"popover_enabled":1,"popover_animation":1,"popover_container":"body","popover_content":"","popover_delay":"0","popover_html":0,"popover_placement":"right","popover_selector":"","popover_title":"","popover_trigger":"click","popover_trigger_autoclose":1},"linuxjournal":{"disqus":{"origin":"https:\/\/www.linuxjournal.com","prettyUrl":"\/article\/9749","fullUrl":"https:\/\/www.linuxjournal.com\/article\/9749","embedUrl":"https:\/\/linuxjournal.disqus.com\/embed.js","shortname":"linuxjournal"}},"statistics":{"data":{"nid":"9749"},"url":"\/core\/modules\/statistics\/statistics.php"},"ajaxTrustedUrl":{"\/search\/node":true},"user":{"uid":0,"permissionsHash":"c6d560e532040877d2aa806f24e67b7bac958bcc1fbe108029a267aa475a1917"}}</script>
<script src="/core/assets/vendor/domready/ready.min.js?v=1.0.8"></script>
<script src="/core/assets/vendor/jquery/jquery.min.js?v=3.2.1"></script>
<script src="/core/assets/vendor/underscore/underscore-min.js?v=1.8.3"></script>
<script src="/core/assets/vendor/jquery/jquery-extend-3.4.0.js?v=3.2.1"></script>
<script src="/core/misc/drupalSettingsLoader.js?v=8.7.3"></script>
<script src="/core/misc/drupal.js?v=8.7.3"></script>
<script src="/core/misc/drupal.init.js?v=8.7.3"></script>
<script src="/themes/contrib/bootstrap/js/drupal.bootstrap.js?r3i2mx"></script>
<script src="/themes/contrib/bootstrap/js/attributes.js?r3i2mx"></script>
<script src="/themes/contrib/bootstrap/js/theme.js?r3i2mx"></script>
<script src="/themes/linuxjournal/bootstrap/assets/javascripts/bootstrap/affix.js?r3i2mx"></script>
<script src="/themes/linuxjournal/bootstrap/assets/javascripts/bootstrap/alert.js?r3i2mx"></script>
<script src="/themes/linuxjournal/bootstrap/assets/javascripts/bootstrap/button.js?r3i2mx"></script>
<script src="/themes/linuxjournal/bootstrap/assets/javascripts/bootstrap/carousel.js?r3i2mx"></script>
<script src="/themes/linuxjournal/bootstrap/assets/javascripts/bootstrap/collapse.js?r3i2mx"></script>
<script src="/themes/linuxjournal/bootstrap/assets/javascripts/bootstrap/dropdown.js?r3i2mx"></script>
<script src="/themes/linuxjournal/bootstrap/assets/javascripts/bootstrap/modal.js?r3i2mx"></script>
<script src="/themes/linuxjournal/bootstrap/assets/javascripts/bootstrap/tooltip.js?r3i2mx"></script>
<script src="/themes/linuxjournal/bootstrap/assets/javascripts/bootstrap/popover.js?r3i2mx"></script>
<script src="/themes/linuxjournal/bootstrap/assets/javascripts/bootstrap/scrollspy.js?r3i2mx"></script>
<script src="/themes/linuxjournal/bootstrap/assets/javascripts/bootstrap/tab.js?r3i2mx"></script>
<script src="/themes/linuxjournal/bootstrap/assets/javascripts/bootstrap/transition.js?r3i2mx"></script>
<script src="/themes/linuxjournal/js/lj-consentmanager.js?r3i2mx"></script>
<script src="/themes/contrib/bootstrap/js/popover.js?r3i2mx"></script>
<script src="/core/modules/statistics/statistics.js?v=8.7.3"></script>
<script src="https://linuxjournal.disqus.com/count.js" async defer id="dsq-count-scr"></script>
<script src="/themes/linuxjournal/js/lj-disqus.js?r3i2mx"></script>

    <!-- START EMBED -->
    <script>
      bizx.cmp.ifConsent('', 'all', function () {
    	bizx.cmp.embedScript("https://api.b2c.com/api/init-448i7exgpyqpr9c144q.js");
       });
    </script>
<noscript><img src="https://api.b2c.com/api/noscript-448i7exgpyqpr9c144q.gif"></noscript>
<!-- END EMBED -->
<!-- Matomo -->
<script type="text/javascript">
var _paq = _paq || [];
function initPiwik() {
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://analytics.linuxjournal.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', '50']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
}
</script>
<noscript><p><img src="https://analytics.linuxjournal.com/piwik.php?idsite=50&amp;rec=1" style="border:0;" alt="" /></p></noscript>
<!-- End Matomo Code -->
<div class="modal-custom overlay-custom" id="ccpa-modal" style="margin-left: 0; display: none; max-width: 100%; width: 100%">
    <div id="modal-content" class="modal-content">
        <div class="modal-header" id="ccpa-modal-content-destination"></div>
        <span class="close" id="modal-close">&times;</span>
    </div>
</div>
  </body>
</html>
